import{j as J,m as ue,n as D}from"./s5kuwhN6.js";import{l as L}from"./BdT36_8W.js";import{i as me,g as ee,Q as N,r as pe,j as de,v as C,J as c,A as ve,x as fe,w as X,o as K,c as he,p as xe,R as ge,V as ye,F as Se,X as Y}from"./DPLBeim1.js";import{u as we,s as Ie,a as be,B as Me,m as ze}from"./BQjU4dwZ.js";import{u as ae}from"./CENEsQq1.js";import{r as te}from"./vxidHdmP.js";function Pe(g,f){return(g%f+f)%f}function Z(g,f,a,t){return L(1-Math.exp(-a*t),g,f)}const Re={__name:"CollageImage",props:{index:{default:0},src:{default:""},offset:{default:{x:0,y:0,z:0}},depth:{default:0},width:{default:0},height:{default:0},minScale:{default:1},maxScale:{default:1.5},active:{default:!1},meta:{default:{}}},setup(g,{expose:f}){const a=g,{object:t}=J(),E={scale:1,alpha:1},j=ae(),i=we({src:a.src,meta:a.meta}),r=new ue;t.add(r),r.add(i.object);const o=new D,h=new D,{repelPosition:u,repelRadius:y,repelScrollStr:F}=me("collage");ee(()=>{});const $=(s,p,k)=>{o.set(s,p,k),h.copy(o),x()},S=new D,B=s=>{h.copy(o),h.y=Pe(h.y+s,a.height)-a.height*.5,x()},w=new D,M=new D(1,1,1),m=()=>{S.copy(h),w.copy(u);const s=y.value*L(F.value,1,2);M.x=s,M.y=s*(j.value,1);const p=S.clone().sub(u);Math.abs(p.x)<.1&&(p.x=.1),p.z=0;const b=p.clone().normalize().multiply(M);S.add(b)},V=s=>{i.material.uniforms.uDimmed.value=s},x=()=>{m(),t.position.copy(S),t.scale.setScalar(E.scale),i.material.uniforms.uAlpha.value=E.alpha};let I=null;const G=({delay:s=0,delay2:p=2,delay3:k=4,skipIntro:b=!1}={})=>{I=de.timeline({delay:s,onUpdate:x})},O=()=>{I==null||I.kill(),x()};return N(()=>{i.material.uniforms.uDepth.value=a.depth}),N(()=>{r.scale.setScalar(te(a.minScale,a.maxScale))}),N(()=>{i.setActive(a.active)}),f({object:t,show:G,reset:O,gridPosition:o,setGridPosition:$,setScroll:B,setDimmed:V,index:a.index,offset:a.offset}),(s,p)=>pe(s.$slots,"default")}},Ae={__name:"Collage",props:{active:{type:Boolean,default:!1},assets:{type:Array,default:()=>[]},folder:{type:String,default:""}},setup(g,{expose:f}){const a=g,t=C([]),E=C(0),j=c(()=>a.active),i=C(2),r=c(()=>(m.value,1.2)),o=c(()=>m.value?2:1.5),h=c(()=>(m.value,1)),u=c(()=>m.value?4:6),y=c(()=>(m.value,4)),F=c(()=>(m.value,2)),$=c(()=>m.value?.5:.7),S=c(()=>m.value?1:1.3),B=c(()=>u.value*y.value*F.value),w=c(()=>({width:(u.value-1)*r.value,height:(y.value-1)*o.value,depth:(F.value-1)*h.value})),M=ve([]),m=ae(),V=new D,x=C(0),{object:I}=J(null,{name:"Section 2 collage"}),{object:G}=J(null,{addToParent:!1,name:"Section 2 collage inner"});I.add(G),fe("collage",{repelPosition:V,repelRadius:i,repelScrollStr:x}),ee(()=>{O(),window.show=Q});const O=()=>{const e=a.assets.filter(l=>l.img),{folder:n}=a;M.value=Array.from({length:B.value},(l,d)=>{const v={x:Math.random(),y:Math.random(),z:Math.random()},z=d%e.length,P=e[z],R=Y?"sm":"lg",A=`${P.img}@${R}.webp`.normalize("NFC"),_=encodeURIComponent(A);return{src:`images/getty/${n}/${_}`,index:d,offset:v,meta:{...P,folder:n}}}),requestAnimationFrame(()=>{p(),U(0)})},s=e=>{i.value=e},p=()=>{const{width:e,height:n,depth:l}=w.value;t.value.forEach(d=>{const{index:v,mesh:z,offset:P}=d,R=.2;L(P.y,-o.value*R,o.value*R);const A=te(-.1,.1),_=v%u.value,q=Math.floor(v%(u.value*y.value)/u.value),H=Math.floor(v/(u.value*y.value));H%2===0||r.value/2,q%2===0||r.value/2;const ne=_%2===0?0:o.value*.2,le=H%2===0?0:o.value/2,ce=e*-.5+_*r.value,ie=q*o.value+ne+le,re=H*-h.value+A;d.setGridPosition(ce,ie,re)})},k=()=>{I.visible=j.value},b=C(0),T=C(0),U=(e=0)=>{T.value+=e},se=e=>{t.value.forEach((n,l)=>{const d=n.gridPosition,z=Math.abs(d.x-w.value.width*.5)<r.value*.7?e:0;n.setDimmed(z)})},Q=({delay:e=0,skipIntro:n=!1}={})=>{const l=Ie(t.value),d=Math.floor(t.value.length/2);l.forEach((v,z)=>{const P=d-Math.abs(v.index-d),R=e+P*.02,A=2+v.index*.01,_=4+z*.02;v.show({delay:R,delay2:A,delay3:_,skipIntro:n})})},oe=()=>{t.value.forEach(e=>{e.reset()})};let W=0;return be(j,({delta:e})=>{const n=T.value-b.value;b.value=Z(b.value,T.value,.05,e),Y||(W=ze(Math.abs(n),0,.15,0,1,!0),x.value=Z(x.value,W,.003,e)),t.value.forEach(l=>{l.setScroll(b.value)})}),X(B,O),N(k),X(i,()=>{U(0)}),f({setCenterDimmedImages:se,show:Q,setScroll:U,setRepelRadius:s,reset:oe}),Me([{name:"progress",value:E,options:{min:0,max:1,step:.001}},{name:"repelRadius",value:i,options:{min:0,max:8,step:.001}},{name:"minScale",value:$,options:{min:.5,max:3,step:.001}},{name:"maxScale",value:S,options:{min:.5,max:3,step:.001}},{name:"xSpacing",value:r,options:{min:0,max:4,step:.001}},{name:"ySpacing",value:o,options:{min:0,max:4,step:.001}},{name:"zSpacing",value:h,options:{min:0,max:4,step:.001}},{name:"xColumns",value:u,options:{min:1,max:10,step:1}},{name:"yRows",value:y,options:{min:1,max:10,step:1}},{name:"zColumns",value:F,options:{min:1,max:10,step:1}}],{title:"Collage"}),(e,n)=>(K(!0),he(Se,null,xe(M.value,l=>(K(),ge(Re,ye({ref_for:!0,ref_key:"refImages",ref:t,key:l.index},l,{width:w.value.width,height:w.value.height+o.value,depth:w.value.depth,"min-scale":$.value,"max-scale":S.value,active:j.value}),null,16,["width","height","depth","min-scale","max-scale","active"]))),128))}};export{Ae as _};
